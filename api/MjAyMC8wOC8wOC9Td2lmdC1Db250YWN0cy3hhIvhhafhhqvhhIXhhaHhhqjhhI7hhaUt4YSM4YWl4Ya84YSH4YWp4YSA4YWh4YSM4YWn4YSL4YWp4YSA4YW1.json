{"title":"[Swift]Contacts - 연락처 정보가져오기","date":"2020-08-08T09:52:18.000Z","date_formatted":{"ll":"Aug 8, 2020","L":"08/08/2020","MM-DD":"08-08"},"link":"2020/08/08/Swift-Contacts-연락처-정보가져오기","tags":["Contacts","Swift"],"categories":["ios"],"updated":"2020-09-14T08:28:54.000Z","content":"<p>Contacts을 이용하여, 앱으로 연락처 정보를 가져오기,!</p>\n<p>들어가기 전에 아래 CNContact에 대한 애플문서를 확인하자.</p>\n<p><a href=\"https://developer.apple.com/documentation/contacts/cncontact\" target=\"_blank\">링크 : https://developer.apple.com/documentation/contacts/cncontact</a></p>\n<p>문서를 요약하자면,</p>\n<p><img src=\"/image/Contact3.png\" alt=\"\" class=\"φcx\"></p>\n<p>오른쪽의 정보들을 가져온다는 뜻.</p>\n<p>나는 phoneNumbers와</p>\n<p>class func descriptorForAllComparatorKeys() -&gt; CNKeyDescriptor<br>\n(연락처 정렬 비교기에 필요한 모든 키를 가져옵니다.)을 이용해 fullname을 가져왔다.</p>\n<p>자세한 내용은<br>\n아래 코드에서 주석으로 숫자를 달았는데, 코드와 비교해보면서 읽어보길 바란다!</p>\n<h2 id=\"1.-viewcontroller\">1. ViewController<a title=\"#1.-viewcontroller\" href=\"#1.-viewcontroller\"></a></h2>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> UIKit</span><br><span class=\"line\"><span class=\"keyword\">import</span> Contacts</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ViewController</span>: <span class=\"title\">UIViewController</span> </span>&#123;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"keyword\">let</span> tableView = <span class=\"type\">UITableView</span>(frame: .zero, style: .grouped)</span><br><span class=\"line\">  <span class=\"keyword\">var</span> objects = [<span class=\"type\">CNContact</span>]() <span class=\"comment\">//1-1.</span></span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">viewDidLoad</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">super</span>.viewDidLoad()</span><br><span class=\"line\">    </span><br><span class=\"line\">    tableView.dataSource = <span class=\"keyword\">self</span></span><br><span class=\"line\">    tableView.delegate = <span class=\"keyword\">self</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    tableView.rowHeight = <span class=\"number\">80</span></span><br><span class=\"line\">    tableView.backgroundColor = .white</span><br><span class=\"line\">    view.addSubview(tableView)</span><br><span class=\"line\">    </span><br><span class=\"line\">    tableView.register(testTableViewCell.<span class=\"keyword\">self</span>, forCellReuseIdentifier: <span class=\"string\">\"testTableViewCell\"</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    </span><br><span class=\"line\">    findContactsOnBackgroundThread &#123; (contacts) <span class=\"keyword\">in</span></span><br><span class=\"line\">      <span class=\"keyword\">self</span>.objects = contacts!</span><br><span class=\"line\">      <span class=\"keyword\">self</span>.tableView.reloadData()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    tableView.translatesAutoresizingMaskIntoConstraints = <span class=\"literal\">false</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"type\">NSLayoutConstraint</span>.activate([</span><br><span class=\"line\">      tableView.topAnchor.constraint(equalTo: view.topAnchor),</span><br><span class=\"line\">      tableView.leadingAnchor.constraint(equalTo: view.leadingAnchor),</span><br><span class=\"line\">      tableView.trailingAnchor.constraint(equalTo: view.trailingAnchor),</span><br><span class=\"line\">      tableView.bottomAnchor.constraint(equalTo: view.bottomAnchor)</span><br><span class=\"line\">    ])</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">findContactsOnBackgroundThread</span> <span class=\"params\">(<span class=\"number\">_</span> completionHandler: @escaping <span class=\"params\">(<span class=\"number\">_</span> contacts:[CNContact]?)</span></span></span>-&gt;()) &#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"type\">DispatchQueue</span>.global(qos: .background).async(execute: &#123; () -&gt; <span class=\"type\">Void</span> <span class=\"keyword\">in</span></span><br><span class=\"line\">      </span><br><span class=\"line\">      <span class=\"comment\">//1-2.</span></span><br><span class=\"line\">      <span class=\"keyword\">let</span> keysToFetch = [<span class=\"type\">CNContactFormatter</span>.descriptorForRequiredKeys(<span class=\"keyword\">for</span>: .fullName), <span class=\"type\">CNContactPhoneNumbersKey</span>] <span class=\"keyword\">as</span> [<span class=\"type\">Any</span>]</span><br><span class=\"line\">      </span><br><span class=\"line\">      <span class=\"keyword\">let</span> fetchRequest = <span class=\"type\">CNContactFetchRequest</span>( keysToFetch: keysToFetch <span class=\"keyword\">as</span>! [<span class=\"type\">CNKeyDescriptor</span>])</span><br><span class=\"line\">      </span><br><span class=\"line\">      <span class=\"comment\">/* This is the array of objects that will be passed into the completion block.</span></span><br><span class=\"line\"><span class=\"comment\">       And then retrieved as the objects array</span></span><br><span class=\"line\"><span class=\"comment\">      objects 배열이 데이터를 검색함.</span></span><br><span class=\"line\"><span class=\"comment\">      */</span></span><br><span class=\"line\">      <span class=\"keyword\">var</span> contacts = [<span class=\"type\">CNContact</span>]()</span><br><span class=\"line\">      </span><br><span class=\"line\">      <span class=\"comment\">//1-3.</span></span><br><span class=\"line\">      <span class=\"type\">CNContact</span>.localizedString(forKey: <span class=\"type\">CNLabelPhoneNumberiPhone</span>)</span><br><span class=\"line\">      </span><br><span class=\"line\">      <span class=\"keyword\">if</span> #available(iOS <span class=\"number\">10.0</span>, *) &#123;</span><br><span class=\"line\">        fetchRequest.mutableObjects = <span class=\"literal\">false</span></span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Fallback on earlier versions</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      </span><br><span class=\"line\">      <span class=\"comment\">//1-4.</span></span><br><span class=\"line\">      fetchRequest.unifyResults = <span class=\"literal\">true</span></span><br><span class=\"line\">      fetchRequest.sortOrder = .userDefault</span><br><span class=\"line\">      </span><br><span class=\"line\">      </span><br><span class=\"line\">      <span class=\"comment\">//연락처를 가져오는 중 에러남. 성공을 위해 do/try/catch block 필요.</span></span><br><span class=\"line\">      <span class=\"comment\">//1-5.</span></span><br><span class=\"line\">     <span class=\"keyword\">do</span> &#123;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\">// For each CNContact in your phone...</span></span><br><span class=\"line\">        <span class=\"keyword\">try</span> <span class=\"type\">CNContactStore</span>().enumerateContacts(with: fetchRequest) &#123; (contact, stop) -&gt; <span class=\"type\">Void</span> <span class=\"keyword\">in</span></span><br><span class=\"line\">          <span class=\"comment\">//연락처를 정렬</span></span><br><span class=\"line\">  </span><br><span class=\"line\">          <span class=\"comment\">// If this contact has a phone number, append to the array</span></span><br><span class=\"line\">          <span class=\"keyword\">if</span> contact.phoneNumbers.<span class=\"built_in\">count</span> &gt; <span class=\"number\">0</span> &#123;</span><br><span class=\"line\">            contacts.append(contact)</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">          </span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\">// Catch the error, if it exists</span></span><br><span class=\"line\">      &#125; <span class=\"keyword\">catch</span> <span class=\"keyword\">let</span> e <span class=\"keyword\">as</span> <span class=\"type\">NSError</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(e.localizedDescription)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      </span><br><span class=\"line\">      <span class=\"type\">DispatchQueue</span>.main.async(execute: &#123; () -&gt; <span class=\"type\">Void</span> <span class=\"keyword\">in</span></span><br><span class=\"line\">        <span class=\"comment\">//완성되면 contacts 배열을 제공</span></span><br><span class=\"line\">        completionHandler(contacts)</span><br><span class=\"line\">        </span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//MARK: -UITableViewDataSource</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">extension</span> <span class=\"title\">ViewController</span>: <span class=\"title\">UITableViewDataSource</span></span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">tableView</span><span class=\"params\">(<span class=\"number\">_</span> tableView: UITableView, numberOfRowsInSection section: Int)</span></span> -&gt; <span class=\"type\">Int</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> objects.<span class=\"built_in\">count</span></span><br><span class=\"line\">    </span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">tableView</span><span class=\"params\">(<span class=\"number\">_</span> tableView: UITableView, cellForRowAt indexPath: IndexPath)</span></span> -&gt; <span class=\"type\">UITableViewCell</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">let</span> cell = tableView.dequeueReusableCell(withIdentifier: <span class=\"string\">\"testTableViewCell\"</span>, <span class=\"keyword\">for</span>: indexPath) <span class=\"keyword\">as</span>! testTableViewCell</span><br><span class=\"line\"> </span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">let</span> contact = <span class=\"keyword\">self</span>.objects[indexPath.row]</span><br><span class=\"line\">    </span><br><span class=\"line\">    configureCell(cell, contact: contact)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> cell</span><br><span class=\"line\">    </span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">extension</span> <span class=\"title\">ViewController</span>: <span class=\"title\">UITableViewDelegate</span></span>&#123;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">tableView</span><span class=\"params\">(<span class=\"number\">_</span> tableView: UITableView, heightForRowAt indexPath: IndexPath)</span></span> -&gt; <span class=\"type\">CGFloat</span> &#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">80</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">configureCell</span><span class=\"params\">(<span class=\"number\">_</span> cell: testTableViewCell, contact: CNContact)</span></span> &#123;</span><br><span class=\"line\">      </span><br><span class=\"line\">      <span class=\"keyword\">let</span> formatter = <span class=\"type\">CNContactFormatter</span>()</span><br><span class=\"line\">      </span><br><span class=\"line\">      <span class=\"keyword\">let</span> contactPhoneNumber = (contact.phoneNumbers[<span class=\"number\">0</span>].value).value(forKey: <span class=\"string\">\"digits\"</span>) <span class=\"keyword\">as</span>? <span class=\"type\">String</span></span><br><span class=\"line\">      </span><br><span class=\"line\">      cell.personName.text = formatter.string(from: contact)</span><br><span class=\"line\">      cell.conditionMassge.text = contactPhoneNumber</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>일단 테스트용으로 만든거라… viewDidLoad가 빵빵 ㅎㅎ…</p>\n<ul>\n<li>\n<p>1-1. <strong>objects = <a href=\"\">CNContact</a></strong> 는 CNContact(연락처)의 배열을 담은 객체</p>\n</li>\n<li>\n<p>1-2. <strong>연락처비교 : class func descriptorForAllComparatorKeys() -&gt;. CNKeyDescriptor<br>\n(연락처 정렬 비교기에 필요한 모든 키를 가져옴.)</strong></p>\n</li>\n</ul>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> keysToFetch = [<span class=\"type\">CNContactFormatter</span>.descriptorForRequiredKeys(<span class=\"keyword\">for</span>: .fullName), <span class=\"type\">CNContactPhoneNumbersKey</span>] <span class=\"keyword\">as</span> [<span class=\"type\">Any</span>]</span><br></pre></td></tr></table></figure>\n<p><strong>keysToFetch</strong>는 CNContactFormatter의 descriptorForRequiredKeys로 접근하여, <strong>.fullName</strong>을 가져오고 CNContactPhoneNumbersKey에도 접근하도록 하는 그릇이다.</p>\n<p>이 그릇을</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   <span class=\"keyword\">let</span> fetchRequest = <span class=\"type\">CNContactFetchRequest</span>( keysToFetch: keysToFetch <span class=\"keyword\">as</span>! [<span class=\"type\">CNKeyDescriptor</span>])</span><br><span class=\"line\">```   </span><br><span class=\"line\">fetchRequest에</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">CNContactFetchRequest</span>(연락처를 일치시키기위한 술어) 에 <span class=\"type\">CNKeyDescriptor</span>의 배열을 업캐스팅하여 <span class=\"type\">CNKeyDescriptor</span>의 정보를 가져온다.</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">CNKeyDescriptor</span>에 대한 정보는 퀵헬퍼로 확인가능. </span><br><span class=\"line\"></span><br><span class=\"line\">![](/image/<span class=\"type\">Contact4</span>.png) </span><br><span class=\"line\"></span><br><span class=\"line\">이렇게 되어있었다 ! ...</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">- <span class=\"number\">1</span>-<span class=\"number\">3</span>. **연락처 데이터 현지화 : </span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">func</span> <span class=\"title\">localizedString</span>(<span class=\"title\">forKey</span>: <span class=\"title\">String</span>) -&gt; <span class=\"title\">String</span></span></span><br><span class=\"line\"><span class=\"class\">지역화 된 연락처 속성 이름이 포함 된 문자열을 반환.** </span></span><br><span class=\"line\"><span class=\"class\"></span></span><br><span class=\"line\"><span class=\"class\">```<span class=\"title\">swift</span></span></span><br><span class=\"line\"><span class=\"class\"><span class=\"title\">CNContact</span>.<span class=\"title\">localizedString</span>(<span class=\"title\">forKey</span>: <span class=\"title\">CNLabelPhoneNumberiPhone</span>)</span></span><br><span class=\"line\"><span class=\"class\">   </span></span><br><span class=\"line\"><span class=\"class\">   <span class=\"title\">if</span> #<span class=\"title\">available</span>(<span class=\"title\">iOS</span> 10.0, *) </span>&#123;</span><br><span class=\"line\">     fetchRequest.mutableObjects = <span class=\"literal\">false</span></span><br><span class=\"line\">   &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">     <span class=\"comment\">// Fallback on earlier versions</span></span><br><span class=\"line\">   &#125;</span><br></pre></td></tr></table></figure>\n<p>localizedString은 문자열을 반환하는 용도, 그중 CNLabelPhoneNumberiPhone 핸드폰 번호를 가져와 반환시킨다.</p>\n<p>만약 iOS10이하면,<br>\nfetchRequest.mutableObjects = falese로<br>\nstring의 값 뮤터블(변수) 변경불가능하게 처리</p>\n<p>이전 버전의 폰이 왔을 때의 대비책인거 같다. 그런데 이미 프로젝트를 13이상에서만 다운할수 있도록 해놔서… ㅎㅎ 안써도될듯하지만… 공부해볼겸 ,!!</p>\n<p>1-4.</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//1-4.</span></span><br><span class=\"line\"> fetchRequest.unifyResults = <span class=\"literal\">true</span></span><br><span class=\"line\"> fetchRequest.sortOrder = .userDefault</span><br></pre></td></tr></table></figure>\n<p><strong>unifyResults</strong>현재 연락처가 통합 연락처이고 지정된 식별자를 가진 연락처를 포함하는지 여부를 나타내는 Bool값. <strong>sortOrder</strong> 연락처의 정렬 순서를 나타냄</p>\n<p>1-5. 연락처의 열거가 성공적으로 실행되었는지 판단. (ㅇㅖ외사항 처리)<br>\n<em>do/try/catch /block</em>을 이용해 오류 판단.</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">do</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">//1-5.</span></span><br><span class=\"line\">  <span class=\"comment\">// For each CNContact in your phone...</span></span><br><span class=\"line\">  <span class=\"keyword\">try</span> <span class=\"type\">CNContactStore</span>().enumerateContacts(with: fetchRequest) &#123; (contact, stop) -&gt; <span class=\"type\">Void</span> <span class=\"keyword\">in</span></span><br><span class=\"line\">    <span class=\"comment\">//연락처를 정렬</span></span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"comment\">// If this contact has a phone number, append to the array</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> contact.phoneNumbers.<span class=\"built_in\">count</span> &gt; <span class=\"number\">0</span> &#123;</span><br><span class=\"line\">      contacts.append(contact)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n<p>do 나는 try하겠다, CNContactStore()을 통해, enumerateContacts(연락처 가져 오기 요청과 일치하는 모든 연락처의 열거가 성공적으로 실행되었는지 여부를 나타내는 부울 값을 반환)에 접근 ~ fetchRequest(검색 기준을 지정하는 연락처 가져 오기 요청.<br>\n)을 요청하여 (contact(성공), stop(오류))시 에 대한 정보 클로저 이용하여 성공 및 오류사항 정의.</p>\n<p>만약 성공시, contact.phoneNumbers.count &gt; 0 { 이면 contxts.append(contact)<br>\n그냥 정렬한다는 소리…</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#125; <span class=\"keyword\">catch</span> <span class=\"keyword\">let</span> e <span class=\"keyword\">as</span> <span class=\"type\">NSError</span> &#123;</span><br><span class=\"line\">       <span class=\"built_in\">print</span>(e.localizedDescription)</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">     </span><br><span class=\"line\">     <span class=\"type\">DispatchQueue</span>.main.async(execute: &#123; () -&gt; <span class=\"type\">Void</span> <span class=\"keyword\">in</span></span><br><span class=\"line\">       <span class=\"comment\">//완성되면 contacts 배열을 제공</span></span><br><span class=\"line\">       completionHandler(contacts)</span><br><span class=\"line\">       </span><br><span class=\"line\">     &#125;)</span><br><span class=\"line\">   &#125;)</span><br><span class=\"line\"> &#125;</span><br></pre></td></tr></table></figure>\n<p>만약 에러나면, e.localizedDescription을 프린트하고, 어씽크(시분할방식 - 비동기) 통해 completionHandler(비동기 완료시점)에 (contacts)반환 (Void를 반환)하여 오류가 반환됨.</p>\n<p>이 메서드는 열거가 완료 될 때까지 기다리기 때문에, 결과가 없으면 블록이 호출되지 않고 메서드가 true를 반환한다.<br>\n모든 연락처를 한 번에 메모리에 보관하지 않고 모든 연락처를 가져오기 때문에 비용이 많이 든다.</p>\n<p>연락처 가져 오기 요청과 일치하는 모든 연락처의 열거가 성공적으로 실행되면 true이고, 그렇지 않으면 거짓</p>\n<p>휴… 동기/비동기를 다시 한번 훑어봐야겠다…<br>\n<a href=\"https://m.blog.naver.com/PostView.nhn?blogId=jdub7138&amp;logNo=220937372865&amp;proxyReferer=https:%2F%2Fwww.google.com%2F\" target=\"_blank\">동기/비동기 참고하기</a></p>\n<p>셀 부분은 그냥 코드보면 대충 무슨 뜻인지 알것이라 생각하고 cell로 넘어가자.</p>\n<h2 id=\"2.-testtableviewcell\">2. testTableViewCell<a title=\"#2.-testtableviewcell\" href=\"#2.-testtableviewcell\"></a></h2>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> UIKit</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">testTableViewCell</span>: <span class=\"title\">UITableViewCell</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">     <span class=\"keyword\">let</span> identifier = <span class=\"string\">\"testTableViewCell\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">let</span> personImage = <span class=\"type\">UIImageView</span>()</span><br><span class=\"line\">      <span class=\"keyword\">let</span> personName = <span class=\"type\">UILabel</span>()</span><br><span class=\"line\">      <span class=\"keyword\">let</span> conditionMassge = <span class=\"type\">UILabel</span>()</span><br><span class=\"line\">      <span class=\"keyword\">let</span> inPerson = <span class=\"type\">UIButton</span>()</span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"comment\">//      let personAddButton = UIButton()</span></span><br><span class=\"line\">  </span><br><span class=\"line\">        <span class=\"keyword\">override</span> <span class=\"keyword\">init</span>(style: <span class=\"type\">UITableViewCell</span>.<span class=\"type\">CellStyle</span>, reuseIdentifier: <span class=\"type\">String?</span>) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">super</span>.<span class=\"keyword\">init</span>(style: style, reuseIdentifier: reuseIdentifier)</span><br><span class=\"line\">          </span><br><span class=\"line\">          selectionStyle = .<span class=\"keyword\">none</span></span><br><span class=\"line\">          </span><br><span class=\"line\">          personImage.backgroundColor = .systemGray4</span><br><span class=\"line\">          personImage.image = <span class=\"type\">UIImage</span>(systemName: <span class=\"string\">\"person\"</span>)</span><br><span class=\"line\">          personImage.tintColor = .lightGray</span><br><span class=\"line\">          personImage.layer.cornerRadius = <span class=\"number\">15</span></span><br><span class=\"line\">          contentView.addSubview(personImage)</span><br><span class=\"line\">          </span><br><span class=\"line\">          personName.text = <span class=\"string\">\"이름\"</span></span><br><span class=\"line\">         <span class=\"comment\">// personName.font = UIFont.boldSystemFont(ofSize: 17)</span></span><br><span class=\"line\">          conditionMassge.font = <span class=\"type\">UIFont</span>(name: <span class=\"string\">\"PingFangHK-Medium\"</span>, size: <span class=\"number\">17</span>)</span><br><span class=\"line\">          contentView.addSubview(personName)</span><br><span class=\"line\">          </span><br><span class=\"line\">          conditionMassge.text = <span class=\"string\">\"즐거운 하루~~ 빛나는 미래가 보여🐶\"</span></span><br><span class=\"line\">          conditionMassge.font = <span class=\"type\">UIFont</span>(name: <span class=\"string\">\"PingFangHK-Thin\"</span>, size: <span class=\"number\">14</span>)</span><br><span class=\"line\">          conditionMassge.textColor = .gray</span><br><span class=\"line\">          contentView.addSubview(conditionMassge)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//  conditionCheck.text = \"21분전\"</span></span><br><span class=\"line\">          inPerson.setTitle(<span class=\"string\">\"+ 초대\"</span>, <span class=\"keyword\">for</span>: .normal)</span><br><span class=\"line\">          inPerson.titleLabel?.font = <span class=\"type\">UIFont</span>(name: <span class=\"string\">\"PingFangHK-Medium\"</span>, size: <span class=\"number\">12</span>)</span><br><span class=\"line\">          inPerson.setTitleColor(.black, <span class=\"keyword\">for</span>: .normal)</span><br><span class=\"line\">          inPerson.layer.borderColor = <span class=\"type\">UIColor</span>.black.cgColor</span><br><span class=\"line\">          inPerson.backgroundColor = .yellow</span><br><span class=\"line\">          inPerson.layer.borderWidth = <span class=\"number\">1</span></span><br><span class=\"line\">          inPerson.layer.cornerRadius = contentView.frame.width/<span class=\"number\">23</span></span><br><span class=\"line\">          contentView.addSubview(inPerson)</span><br><span class=\"line\">          </span><br><span class=\"line\">          setConstrain()</span><br><span class=\"line\">          </span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">      <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">setConstrain</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        </span><br><span class=\"line\">        레이아웃은 생략..</span><br><span class=\"line\"></span><br><span class=\"line\">        ])</span><br><span class=\"line\">        </span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">        <span class=\"keyword\">required</span> <span class=\"keyword\">init</span>?(coder aDecoder: <span class=\"type\">NSCoder</span>) &#123;</span><br><span class=\"line\">          <span class=\"built_in\">fatalError</span>(<span class=\"string\">\"init(coder:) has not been implemented\"</span>)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>위의 vc가 연락처목록을 가져오는 tablewView였다면, estTableViewCell은<br>\n그에 대한 셀이다.</p>\n<p>테스트용으로 만든것이라서… 변수명이 좀 헷깔릴 수 있는데</p>\n<p>conditionMassge가 폰넘버에 해당된다. 원래 상태메세지 가져오는 걸 구현할 계획이었던거라… 번호는 사실 셀에 표현안되어도 되지만 눈으로 확인하기 위해 여기다가 뿌렸다…ㅋㅋㅋ…</p>\n<p>아래 이미지를 보면 이해가 더 쉬울것 같다. 🙂</p>\n<p><img src=\"/image/Contacts.png\" alt=\"\" class=\"φcx\"></p>\n<p>이러케 ㅎㅎ…</p>\n<p>어쨌든 나는 이름과 폰넘버만 가져왔지만,<br>\n필드만 지정해주면 연락처상에 저장된 모든 데이터(NCContact)를 통해 메모,이메일, 기념일?등도 가져올 수 있다는점 !!!</p>\n<p>그리고 폰넘버가 만약 2개 저장된 정보라면, 가장 상단에 있는 값을 가져온다는 점!</p>\n<p>알아두면 좋을 듯 하다!</p>\n","prev":{"title":"[Swift]Textfield 터치시 키보드내리기, 리턴시 커서이동(resignFirstResponder())","link":"2020/08/09/Swift-Textfield-터치시-키보드내리기-리턴시-커서이동"},"next":{"title":"[Swift]Custom Tabbar","link":"2020/08/07/Swift-Custom-Tabbar"},"plink":"https://Qussk.github.io/2020/08/08/Swift-Contacts-연락처-정보가져오기/","toc":[{"id":"1.-viewcontroller","title":"1. ViewController","index":"1"},{"id":"2.-testtableviewcell","title":"2. testTableViewCell","index":"2"}]}