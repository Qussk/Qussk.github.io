{"title":"[SWift]HealthKit 사용","date":"2020-08-10T13:36:31.000Z","date_formatted":{"ll":"Aug 10, 2020","L":"08/10/2020","MM-DD":"08-10"},"link":"2020/08/10/SWift-HealthKit-사용","tags":["HealthKit","Swift"],"categories":["ios"],"updated":"2020-10-16T04:40:45.000Z","content":"<h3 id=\"info.plist\">info.plist<a title=\"#info.plist\" href=\"#info.plist\"></a></h3>\n<p><img src=\"image/HealthKit.png\" alt=\"\" class=\"φcx\"></p>\n<h3 id=\"healthkit\">HealthKit<a title=\"#healthkit\" href=\"#healthkit\"></a></h3>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> UIKit</span><br><span class=\"line\"><span class=\"keyword\">import</span> HealthKit</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ViewController</span>: <span class=\"title\">UIViewController</span> </span>&#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">let</span> healthStore = <span class=\"type\">HKHealthStore</span>()</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">viewDidLoad</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.viewDidLoad()</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"type\">HKHealthStore</span>.isHealthDataAvailable())</span><br><span class=\"line\">        authorizeHealthKit()</span><br><span class=\"line\">        getTotalStepCount()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">authorizeHealthKit</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> read = <span class=\"type\">Set</span>([<span class=\"type\">HKObjectType</span>.quantityType(forIdentifier: .stepCount)!])</span><br><span class=\"line\">        <span class=\"keyword\">let</span> write = <span class=\"type\">Set</span>([<span class=\"type\">HKObjectType</span>.quantityType(forIdentifier: .stepCount)!])</span><br><span class=\"line\">        </span><br><span class=\"line\">        healthStore.requestAuthorization(toShare: write, read: read) &#123; (success, error) <span class=\"keyword\">in</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> success == <span class=\"literal\">true</span> &#123;</span><br><span class=\"line\">                <span class=\"built_in\">print</span>(<span class=\"string\">\"permisson granted\"</span>)</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">getTotalStepCount</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> sampleType = <span class=\"type\">HKObjectType</span>.quantityType(forIdentifier: .stepCount) <span class=\"keyword\">else</span> &#123; <span class=\"keyword\">return</span> <span class=\"built_in\">print</span>(<span class=\"string\">\"Guard Activated\"</span>) &#125;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> startDate = <span class=\"type\">Calendar</span>.current.startOfDay(<span class=\"keyword\">for</span>: <span class=\"type\">Date</span>())</span><br><span class=\"line\">        <span class=\"keyword\">let</span> predicate = <span class=\"type\">HKQuery</span>.predicateForSamples(withStart: startDate, end: <span class=\"type\">Date</span>(), options: .strictStartDate)</span><br><span class=\"line\">        <span class=\"keyword\">var</span> intervar = <span class=\"type\">DateComponents</span>()</span><br><span class=\"line\">        intervar.weekday = <span class=\"number\">1</span> <span class=\"comment\">//변경가능(오늘)</span></span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">let</span> query = <span class=\"type\">HKStatisticsCollectionQuery</span>(</span><br><span class=\"line\">            quantityType: sampleType,</span><br><span class=\"line\">            quantitySamplePredicate: predicate,</span><br><span class=\"line\">            options: .cumulativeSum,</span><br><span class=\"line\">            anchorDate: startDate,</span><br><span class=\"line\">            intervalComponents: intervar)</span><br><span class=\"line\">        </span><br><span class=\"line\">        query.initialResultsHandler = &#123; (sample, result, error) <span class=\"keyword\">in</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"keyword\">let</span> myResult = result &#123;</span><br><span class=\"line\">                myResult.enumerateStatistics(</span><br><span class=\"line\">                    from: startDate,</span><br><span class=\"line\">                    to: <span class=\"type\">Date</span>()) &#123; (statistics, value) <span class=\"keyword\">in</span></span><br><span class=\"line\">                        <span class=\"keyword\">if</span> <span class=\"keyword\">let</span> <span class=\"built_in\">count</span> = statistics.sumQuantity() &#123;</span><br><span class=\"line\">                            <span class=\"keyword\">let</span> val = <span class=\"built_in\">count</span>.doubleValue(<span class=\"keyword\">for</span>: <span class=\"type\">HKUnit</span>.<span class=\"built_in\">count</span>())</span><br><span class=\"line\">                            <span class=\"built_in\">print</span>(val) <span class=\"comment\">//내용</span></span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        healthStore.execute(query)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","prev":{"title":"[Swift] FierBase 실시간 데이터 베이스","link":"2020/08/11/Swift-FierBase-실시간-데이터-베이스"},"next":{"title":"[Swift]Textfield 터치시 키보드내리기, 리턴시 커서이동(resignFirstResponder())","link":"2020/08/09/Swift-Textfield-터치시-키보드내리기-리턴시-커서이동"},"plink":"https://Qussk.github.io/2020/08/10/SWift-HealthKit-사용/","toc":[{"id":"info.plist","title":"info.plist","index":"1"},{"id":"healthkit","title":"HealthKit","index":"2"}]}