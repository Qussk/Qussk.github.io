{"title":"[Swift]MapKit 이해하기","date":"2020-06-23T13:31:35.000Z","date_formatted":{"ll":"Jun 23, 2020","L":"06/23/2020","MM-DD":"06-23"},"link":"2020/06/23/Swift-MapKit-이해하기","tags":["MapKit","Swift"],"categories":["ios"],"updated":"2020-09-14T08:28:54.126Z","content":"<h2 id=\"0.-import-mapkit\">0. import MapKit<a title=\"#0.-import-mapkit\" href=\"#0.-import-mapkit\"></a></h2>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> MapKit</span><br></pre></td></tr></table></figure>\n<p><img src=\"/image/map9.png\" alt=\"\" class=\"φcx\"></p>\n<p>0-1. 임포트를 하게되면 일단 기본적인 맵킷이 나온다.</p>\n<h2 id=\"1.-권한요청\">1. 권한요청<a title=\"#1.-권한요청\" href=\"#1.-권한요청\"></a></h2>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">checkAuthorizationStatus</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">switch</span> <span class=\"type\">CLLocationManager</span>.authorizationStatus() &#123;</span><br><span class=\"line\"><span class=\"keyword\">case</span> .notDetermined:</span><br><span class=\"line\">  locationManager.requestWhenInUseAuthorization()</span><br><span class=\"line\"><span class=\"keyword\">case</span> .restricted, .denied: <span class=\"keyword\">break</span></span><br><span class=\"line\"><span class=\"keyword\">case</span> .authorizedWhenInUse:</span><br><span class=\"line\">  <span class=\"keyword\">fallthrough</span></span><br><span class=\"line\"><span class=\"keyword\">case</span> .authorizedAlways:</span><br><span class=\"line\">  startUpdatingLocation()</span><br><span class=\"line\">@unknown <span class=\"keyword\">default</span>: <span class=\"built_in\">fatalError</span>()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>1-1. info.plist에서 권한요청하기. (Privacy - Location When In Use Usage Description)<br>\n1-2. @컴파일러가 별도의 키워드로 인식하기 위해 필요한 것. (Attribut)</p>\n<h2 id=\"2.-cllocationmanager\">2. CLLocationManager<a title=\"#2.-cllocationmanager\" href=\"#2.-cllocationmanager\"></a></h2>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">startUpdatingLocation</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> status = <span class=\"type\">CLLocationManager</span>.authorizationStatus() </span><br><span class=\"line\">  <span class=\"keyword\">guard</span> status == .authorizedAlways || status == .authorizedWhenInUse,</span><br><span class=\"line\">    <span class=\"type\">CLLocationManager</span>.locationServicesEnabled()</span><br><span class=\"line\">    <span class=\"keyword\">else</span> &#123; <span class=\"keyword\">return</span> &#125;</span><br><span class=\"line\">  locationManager.desiredAccuracy = kCLLocationAccuracyBest</span><br><span class=\"line\">  locationManager.distanceFilter = kCLHeadingFilterNone</span><br><span class=\"line\">  locationManager.startUpdatingLocation()</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>2-1. <strong>status</strong> 사용자가 위치정보 서비스를 허용했는지 안했는지 체크<br>\n2-2. <strong>kCLLocationAccuracyNearestTenMeters</strong> 10미터 단위로 (기본값은 <strong>kCLLocationAccuracyBest</strong>) 단, 너무 짧을 경우 베터리 소진량 늘어남<br>\n2-3. <strong>startUpdatingLocation</strong> 실제로 update를 요청하는 값</p>\n<h2 id=\"3.--cllocationmanagerdelegate\">3.  CLLocationManagerDelegate<a title=\"#3.--cllocationmanagerdelegate\" href=\"#3.--cllocationmanagerdelegate\"></a></h2>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">locationManager.delegate = <span class=\"keyword\">self</span></span><br></pre></td></tr></table></figure>\n<p>3-1. delegate self선언</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">extension</span> <span class=\"title\">MyLocationViewController</span>: <span class=\"title\">CLLocationManagerDelegate</span> </span>&#123;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">locationManager</span><span class=\"params\">(<span class=\"number\">_</span> manager: CLLocationManager, didChangeAuthorization status: CLAuthorizationStatus)</span></span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">switch</span> status &#123;</span><br><span class=\"line\">  <span class=\"keyword\">case</span> .authorizedWhenInUse, .authorizedAlways:</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">\"Authorized\"</span>)</span><br><span class=\"line\">  <span class=\"keyword\">default</span>:</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">\"Unauthorized\"</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">locationManager</span><span class=\"params\">(<span class=\"number\">_</span> manager: CLLocationManager, didUpdateLocations locations: [CLLocation])</span></span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> current = locations.last! <span class=\"comment\">//라스트 값을 가져옴.</span></span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"built_in\">abs</span>(current.timestamp.timeIntervalSinceNow) &lt; <span class=\"number\">10</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> coordinate = current.coordinate</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// Span 단위는 1도</span></span><br><span class=\"line\">    <span class=\"comment\">// 경도 1도는 약 111킬로미터. 위도 1도는 위도에 따라 변함.</span></span><br><span class=\"line\">    <span class=\"comment\">// 적도 (약 111 Km) ~ 극지방 (0 Km)</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> span = <span class=\"type\">MKCoordinateSpan</span>(latitudeDelta: <span class=\"number\">0.002</span>, longitudeDelta: <span class=\"number\">0.002</span>)</span><br><span class=\"line\">    <span class=\"keyword\">let</span> region = <span class=\"type\">MKCoordinateRegion</span>(center: coordinate, span: span)</span><br><span class=\"line\">    mapView.setRegion(region, animated: <span class=\"literal\">true</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    addAnnotation(location: current)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">addAnnotation</span><span class=\"params\">(location: CLLocation)</span></span> &#123;</span><br><span class=\"line\">   <span class=\"keyword\">let</span> annotation = <span class=\"type\">MKPointAnnotation</span>()</span><br><span class=\"line\">   annotation.title = <span class=\"string\">\"MyLocation\"</span></span><br><span class=\"line\">   annotation.coordinate = location.coordinate</span><br><span class=\"line\">   mapView.addAnnotation(annotation)</span><br><span class=\"line\"> &#125;</span><br></pre></td></tr></table></figure>\n<p>3-2. <strong>didChangeAuthorization</strong> 권한 확인(1.의 checkAuthorizationStatus부분.)<br>\n3-3. <strong>didUpdateLocations</strong>   로케이션(위치)의 정보를 받는곳<br>\n3-4. <strong>addAnnotation</strong>는 위치 라벨(네임) 가져오기.<br>\n3-5. <strong>span</strong>값 넓힐 수록 가까이됨. 뷰디드로드에 ( mapView.showsUserLocation = true)로 지정</p>\n<h2 id=\"4.-showsuserlocation\">4. showsUserLocation<a title=\"#4.-showsuserlocation\" href=\"#4.-showsuserlocation\"></a></h2>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mapView.showsUserLocation = <span class=\"literal\">true</span></span><br><span class=\"line\">mapView.mapType = .satellite</span><br></pre></td></tr></table></figure>\n<p>4-1. 뷰디드로드에 showsUserLocation = true</p>\n<h2 id=\"5.-방향-추가\">5. 방향 추가<a title=\"#5.-방향-추가\" href=\"#5.-방향-추가\"></a></h2>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  <span class=\"comment\">//방향모니터값 가져오기</span></span><br><span class=\"line\">  <span class=\"meta\">@IBAction</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">mornitoringHeading</span><span class=\"params\">(<span class=\"number\">_</span> sender: <span class=\"keyword\">Any</span>)</span></span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">guard</span> <span class=\"type\">CLLocationManager</span>.headingAvailable() <span class=\"keyword\">else</span> &#123; <span class=\"keyword\">return</span> &#125;</span><br><span class=\"line\">    locationManager.startUpdatingHeading()</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"meta\">@IBAction</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">stopMornitoring</span><span class=\"params\">(<span class=\"number\">_</span> sender: <span class=\"keyword\">Any</span>)</span></span> &#123;</span><br><span class=\"line\">    locationManager.stopUpdatingHeading()</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>5-1. “방향모니터링”, “방향모니터링중단” Button의 모니터 방향값 가져오기.</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//방향불러오는 함수</span></span><br><span class=\"line\"> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">locationManager</span><span class=\"params\">(<span class=\"number\">_</span> manager: CLLocationManager, didUpdateHeading newHeading: CLHeading)</span></span> &#123;</span><br><span class=\"line\">   <span class=\"built_in\">print</span>(<span class=\"string\">\"trueHeading :\"</span>, newHeading.trueHeading)  <span class=\"comment\">// 진북(어디에서든 북쪽 고정)</span></span><br><span class=\"line\">   <span class=\"built_in\">print</span>(<span class=\"string\">\"magneticHeading :\"</span>, newHeading.magneticHeading)  <span class=\"comment\">// 자북 (자기장)</span></span><br><span class=\"line\"> &#125;</span><br></pre></td></tr></table></figure>\n<p>5-2. didUpdateHeading 이용</p>\n<h2 id=\"6.기타\">6.기타<a title=\"#6.기타\" href=\"#6.기타\"></a></h2>\n<p><img src=\"/image/map10.png\" alt=\"\" class=\"φcx\"></p>\n<p>시뮬레이터에서 해당값을 지정하면, 달리는 모션으로 지도를 볼 수 있음.</p>\n<p><img src=\"/image/map12.png\" alt=\"\" class=\"φcx\"></p>\n","prev":{"title":"[Swift]MapKit이해하기-2(with: Geocoding)","link":"2020/06/23/Swift-MapKit이해하기-2-with-Geocoding"},"next":{"title":"[Swift]HeaderView와 FooterView 이용예제","link":"2020/06/20/Swift-HeaderView와-FooterView-이용예제"},"plink":"https://Qussk.github.io/2020/06/23/Swift-MapKit-이해하기/","toc":[{"id":"0.-import-mapkit","title":"0. import MapKit","index":"1"},{"id":"1.-권한요청","title":"1. 권한요청","index":"2"},{"id":"2.-cllocationmanager","title":"2. CLLocationManager","index":"3"},{"id":"3.--cllocationmanagerdelegate","title":"3.  CLLocationManagerDelegate","index":"4"},{"id":"4.-showsuserlocation","title":"4. showsUserLocation","index":"5"},{"id":"5.-방향-추가","title":"5. 방향 추가","index":"6"},{"id":"6.기타","title":"6.기타","index":"7"}]}